<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://osg-htc.org/user-school-2017/materials/day1/part2-ex6-queue-from/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>2.6. queue from - OSG User School 2017</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../css/extra.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Monday Exercise 2.6: Submit With \u201cqueue from\u201d", url: "#_top", children: [
              {title: "More Job Submission Alternatives", url: "#more-job-submission-alternatives" },
              {title: "Queue Jobs From File Contents", url: "#queue-jobs-from-file-contents" },
              {title: "Extra Challenge 1", url: "#extra-challenge-1" },
              {title: "Extra Challenge 2", url: "#extra-challenge-2" },
              {title: "Extra Challenge 3", url: "#extra-challenge-3" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <style type="text/css"> pre em { font-style: normal; background-color: yellow; } pre strong { font-style: normal; font-weight: bold; color: \#008; } </style>

<h1 id="monday-exercise-26-submit-with-queue-from">Monday Exercise 2.6: Submit With “queue from”<a class="headerlink" href="#monday-exercise-26-submit-with-queue-from" title="Permanent link">&para;</a></h1>
<p>The goal of this exercise is to submit many jobs from a single submit file by using the <code>queue ... from</code> syntax to read variable values from a file.</p>
<h2 id="more-job-submission-alternatives">More Job Submission Alternatives<a class="headerlink" href="#more-job-submission-alternatives" title="Permanent link">&para;</a></h2>
<p>In the previous exercise, we use the <code>queue ... matching</code> syntax, which is primarily useful for collections of files with similar names. But that method has its weaknesses, too. It is less useful when a collection of files does not have a consistent and unique pattern for its names, or when the values for different job conditions are <strong>not</strong> filenames, or both.</p>
<h2 id="queue-jobs-from-file-contents">Queue Jobs From File Contents<a class="headerlink" href="#queue-jobs-from-file-contents" title="Permanent link">&para;</a></h2>
<p>Suppose we want to modify our word-frequency analysis a little bit so that it outputs only the most common <em>N</em> words of a document. Further, we want to experiment with different values of <em>N</em>. And finally, even though we downloaded it, we no longer want to analyze the Sherlock Holmes stories in the <code>TAoSH.txt</code> file. Clearly, <code>queue ... matching</code> will not help us in this case.</p>
<p>First, we need a new version of the word counting program so that in accepts an extra number as a command line argument and outputs only that many of the most common words. Here is the new code:</p>
<pre class="codehilite"><code class="language-file">#!/usr/bin/env python

import os
import sys
import operator

if len(sys.argv) != 3:
    print 'Usage: %s DATA NUM_WORDS' % (os.path.basename(sys.argv[0]))
    sys.exit(1)
input_filename = sys.argv[1]
num_words = int(sys.argv[2])

words = {}

my_file = open(input_filename, 'r')
for line in my_file:
    line_words = line.split()
    for word in line_words:
        if word in words:
            words[word] += 1
        else:
            words[word] = 1
my_file.close()

sorted_words = sorted(words.items(), key=operator.itemgetter(1))
for word in sorted_words[-num_words:]:
    print '%s %8d' % (word[0], word[1])
</code></pre>

<p>To submit this program with a collection of two variables values for each run:</p>
<ol>
<li>In the same directory as the last exercise, save the script as <code>wordcount-top-n.py</code></li>
<li>Copy your submit file from the last exercise to a new name (maybe <code>wordcount-top.sub</code>)</li>
<li>Update the <code>executable</code> and <code>log</code> statements as appropriate</li>
<li>Update other statements to work with two variables, <code>book</code> and <code>n</code>:\ <pre class="file"></li>
</ol>
<p>output = $(book)_top_$(n).out error = $(book)_top_$(n).err transfer_input_files = $(book) arguments = "$(book) $(n)" queue book, n from books_n.txt </pre>\ <p>Note especially the changes to the <code>queue</code> statement; it now tells HTCondor to read a separate text file of <strong><em>pairs</em></strong> of values, which will be assigned to <code>book</code> and <code>n</code> respectively.</p></p>
<ol>
<li>Create the separate text file of job variable values and save it as <code>books_n.txt</code>: <pre class="file"></li>
</ol>
<p>AAiW.txt, 10 AAiW.txt, 25 AAiW.txt, 50 PandP.txt, 10 PandP.txt, 25 PandP.txt, 50 </pre>\ <p>Note that we used 3 different values for <em>N</em> for each book, and that we dropped the Sherlock Holmes book, <code>TAoSH.txt</code>.</p></p>
<ol>
<li>Submit the file</li>
<li>Do a quick sanity check: How many jobs were submitted? How many log, output, and error files were created?</li>
</ol>
<h2 id="extra-challenge-1">Extra Challenge 1<a class="headerlink" href="#extra-challenge-1" title="Permanent link">&para;</a></h2>
<p>Between this exercise and the previous one, you have explored two of the three primary <code>queue</code> statements. How would you use the <code>queue in ... list</code> statement to accomplish the same thing(s) as one or both of the exercises?</p>
<h2 id="extra-challenge-2">Extra Challenge 2<a class="headerlink" href="#extra-challenge-2" title="Permanent link">&para;</a></h2>
<p>You may have noticed that the output of these jobs has a messy naming convention. Because our macros resolve to the filenames, including their extension (e.g., <code>AAiW.txt</code>), the output filenames contain with multiple extensions (e.g., <code>AAiW.txt.err</code>). Although the extra extension is acceptable, it makes the filenames harder to read and possibly organize. Change your submit file for this exercise so that the output filenames do not include the <code>.txt</code> extension.</p>
<h2 id="extra-challenge-3">Extra Challenge 3<a class="headerlink" href="#extra-challenge-3" title="Permanent link">&para;</a></h2>
<p>Adjust your <code>queue...matching</code> submit file so that those results also don't include the <code>.txt</code> extension. (<strong>Hint</strong>: You can use function macros to format variables. Check <a href="https://research.cs.wisc.edu/htcondor/manual/v8.5/2_5Submitting_Job.html">the HTCondor Manual</a>.)</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../part3-ex1-job-retry/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../part3-ex1-job-retry/" class="btn btn-xs btn-link">
        3.1. Retries
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../part2-ex5-queue-matching/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../part2-ex5-queue-matching/" class="btn btn-xs btn-link">
        2.5. queue matching
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>